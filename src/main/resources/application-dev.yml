# =============================================================================
# CONFIGURAÇÃO PARA AMBIENTE DE DESENVOLVIMENTO (LOCAL)
# =============================================================================
# Profile ativo: dev
# Uso: java -jar app.jar --spring.profiles.active=dev
# ou: export SPRING_PROFILES_ACTIVE=dev
# =============================================================================

spring:
  # Datasource - PostgreSQL local
  datasource:
    url: jdbc:postgresql://${DB_HOST:localhost}:${DB_PORT:5432}/${DB_NAME:ppg_hub_dev}
    username: ${DB_USER:postgres}
    password: ${DB_PASSWORD:postgres}
    hikari:
      maximum-pool-size: 5
      minimum-idle: 2
      connection-timeout: 30000

  # JPA/Hibernate - Desenvolvimento
  jpa:
    show-sql: true
    properties:
      hibernate:
        format_sql: true
        use_sql_comments: true
        jdbc:
          batch_size: 20

  # Flyway - Migrations
  flyway:
    enabled: true
    baseline-on-migrate: true
    clean-disabled: false # Permite limpar DB em dev

  # Redis - Cache local
  data:
    redis:
      host: ${REDIS_HOST:localhost}
      port: ${REDIS_PORT:6379}
      password: ${REDIS_PASSWORD:}

  # Cache configuração
  cache:
    type: redis
    redis:
      time-to-live: 600000 # 10 minutos em dev (cache mais curto)

  # Jackson - JSON
  jackson:
    serialization:
      indent-output: true # Pretty print em dev

  # DevTools
  devtools:
    restart:
      enabled: true
    livereload:
      enabled: true

# Server
server:
  port: ${SERVER_PORT:8080}
  servlet:
    context-path: /api
  error:
    include-message: always
    include-stacktrace: always # Stacktrace completo em dev
    include-binding-errors: always

# OpenAlex API
openalex:
  api:
    base-url: https://api.openalex.org
    email: ${OPENALEX_EMAIL:dev@ppghub.local}
    timeout: 30000
    max-retries: 3
    rate-limit:
      max-requests-per-day: 100000
      requests-per-second: 5 # Mais conservador em dev

# Actuator - Métricas e Health
management:
  endpoints:
    web:
      exposure:
        include: '*' # Todos os endpoints em dev
  endpoint:
    health:
      show-details: always # Sempre mostrar detalhes em dev
  metrics:
    export:
      prometheus:
        enabled: true

# OpenAPI/Swagger
springdoc:
  api-docs:
    path: /v3/api-docs
    enabled: true
  swagger-ui:
    path: /swagger-ui.html
    enabled: true # Swagger habilitado em dev
    operations-sorter: method
    tags-sorter: alpha
    try-it-out-enabled: true

# Logging - Desenvolvimento (verboso)
logging:
  level:
    root: INFO
    com.ppghub: DEBUG
    org.springframework.web: DEBUG
    org.springframework.security: DEBUG
    org.hibernate.SQL: DEBUG
    org.hibernate.type.descriptor.sql.BasicBinder: TRACE
    org.flywaydb: DEBUG
  pattern:
    console: "%clr(%d{yyyy-MM-dd HH:mm:ss.SSS}){faint} %clr(%5p) %clr(${PID:- }){magenta} %clr(---){faint} %clr([%15.15t]){faint} %clr(%-40.40logger{39}){cyan} %clr(:){faint} %m%n%wEx"
  file:
    name: logs/ppg-hub-dev.log
    max-size: 10MB
    max-history: 7

# Configurações específicas da aplicação
app:
  environment: development
  features:
    swagger-enabled: true
    cors-enabled: true
    actuator-unrestricted: true
  cors:
    allowed-origins:
      - http://localhost:3000
      - http://localhost:4200
      - http://localhost:8080
    allowed-methods:
      - GET
      - POST
      - PUT
      - DELETE
      - PATCH
      - OPTIONS
    allowed-headers: '*'
    allow-credentials: true
